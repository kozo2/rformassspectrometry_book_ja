# Introduction {#sec-msintro}


## 質量分析法はどのように機能するのか？

質量分析法（MS）は、荷電分子（イオン）を質量対電荷比（M/Z）に基づいて*分離*する技術です。
通常はクロマトグラフィー（液体クロマトグラフィー：LC、または気体クロマトグラフィー：GC）と組み合わせて使用されます。
分析対象物質がクロマトグラフィーのカラムから溶出するのにかかる時間を*保持時間*（リテンションタイム）と呼びます。

```{r, results='markup', fig.cap="A chromatogram, illustrating the total amount of analytes over the retention time.", echo=FALSE, purl=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics("./img/chromatogram.png")
```

質量分析計は以下の3つの構成要素から成り立っています：

1. *イオン化源*：分子をイオン化する装置で、例としてマトリックス支援レーザー脱離イオン化（MALDI）やエレクトロスプレーイオン化（ESI）などがあります。
2. *分析器*：イオンを分離する装置で、例として飛行時間型（TOF）やOrbitrapがあります。
3. *検出器*：イオンを定量化する装置です。

プロテオミクスのために質量分析を使用する場合、タンパク質は最初にトリプシンなどのプロテアーゼによって消化されます。
ショットガンプロテオミクスにおいて、質量分析計で測定される分析対象はペプチドです。

多くの場合、イオンは1回以上のMS測定を受けます。
最初の分離段階では、スペクトル中のピーク（MS1スペクトルと呼ばれる）はペプチドを表します。
この段階で得られる情報は、ペプチドの保持時間と質量対電荷比（M/Z）のみです（同位体分布、つまり個々の同位体のピークを見ることで電荷状態も推定可能ですが、詳細は後述）。
しかし、これだけではペプチドの同定（すなわち配列の推定）には不十分です。

MSMS（またはMS2）では、質量分析計の設定が自動的に行われ、MS1スペクトルのピークのうち一定数（例えば20個）が選択されます。^\[ここではMS1ピークが選択されるデータ依存型取得（DDA）に焦点を当てます。データ非依存型取得（DIA）では、MS1スペクトル中のすべてのピークが断片化されます。] 
一定の狭いM/Z範囲（高強度なピーク＝ペプチド、加えて背景ノイズを含む）を選択し、その範囲内のイオンを断片化します（例：衝突誘起解離（CID）、高エネルギー衝突解離（HCD）、電子移動解離（ETD）など）。
その後、断片化されたイオンが分析器で再度分離され、MS2スペクトルが生成されます。
このユニークな断片イオンパターンを用いて、ペプチドの配列を推定します。
スペクトルの品質が十分に高い場合には**デノボ配列決定**が可能ですし、そうでない場合はMascotやMSGF+などの**サーチエンジン**を用いて、実験スペクトルと理論スペクトルを比較・照合することで同定が行われます（詳細は後述）。

```{r, results='markup', fig.cap="Schematics of a mass spectrometer and two rounds of MS.", echo=FALSE, purl=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics("./img/SchematicMS2.png")
```


以下のアニメーションは、25種類の異なるイオン（すなわち、異なるM/Z値を持つイオン）がMS解析の過程でどのように分離され、最終的に検出（すなわち定量）されるかを示しています。
最後のフレームは仮想的なスペクトルを示しています。


```{r, results='markup', fig.cap="Separation and detection of ions in a mass spectrometer.", echo=FALSE, purl=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics("./img/mstut.gif")
```

下の図は、2段階のMS（質量分析）を示しています。
左側のスペクトルは、溶出開始から21分3秒後に取得されたMS1スペクトルです。
点線の縦線で示された10個のピークがMS2解析のために選択されました。
MS1スペクトル上では、M/Z 460.79（488.8）のピークが赤（オレンジ）の縦線で強調表示されており、そのフラグメントスペクトルが右上（右下）のMS2スペクトルとして示されています。

```{r, results='markup', fig.cap="Parent ions in the MS1 spectrum (left) and two sected fragment ions MS2 spectra (right)", echo=FALSE, purl=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics("./img/MS1-MS2-spectra.png")
```

以下の図は、MSデータの3つの次元を表しています。
すなわち、保持時間ごとのスペクトル（M/Zおよび強度）の集合、そしてMS1とMS2（さらに多くのレベルが存在する可能性もあります）のデータが交互に記録される性質です。

```{r, results='markup', fig.cap="MS1 spectra over retention time.", echo=FALSE, purl=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics("./img/F02-3D-MS1-scans-400-1200-lattice.png")
```

```{r, results='markup', fig.cap="MS2 spectra interleaved between two MS1 spectra.", echo=FALSE, purl=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics("./img/F02-3D-MS1-MS2-scans-100-1200-lattice.png")
```

## Accessing data

### From the ProteomeXchange database {-}

MS-based proteomics data is disseminated through the
[ProteomeXchange](http://www.proteomexchange.org/) infrastructure,
which centrally coordinates submission, storage and dissemination
through multiple data repositories, such as the
[PRoteomics IDEntifications (PRIDE)](https://www.ebi.ac.uk/pride/archive/)
database at the EBI for mass spectrometry-based experiments (including
quantitative data, as opposed as the name suggests),
[PASSEL](http://www.peptideatlas.org/passel/) at the ISB for Selected
Reaction Monitoring (SRM, i.e. targeted) data and the
[MassIVE](http://massive.ucsd.edu/ProteoSAFe/static/massive.jsp)
resource. These data can be downloaded within R using the
`r Biocpkg("rpx")` package.


```{r rpx}
library("rpx")
```

Using the unique `PXD000001` identifier, we can retrieve the relevant
metadata that will be stored in a `PXDataset` object. The names of the
files available in this data can be retrieved with the `pxfiles`
accessor function.

```{r pxd}
px <- PXDataset("PXD000001")
px
pxfiles(px)
```

Other metadata for the `px` data set:

```{r pxvar}
pxtax(px)
pxurl(px)
pxref(px)
```

Data files can then be downloaded with the `pxget` function. Below, we
retrieve the raw data file. The file is
downloaded^[If the file is already available, it is not downloaded a second time.]
in the working directory and the name of the file is return by the
function and stored in the `mzf` variable for later use ^[This and other files are also availabel in the `msdata` package, described below].

```{r pxget}
fn <- "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01-20141210.mzML"
mzf <- pxget(px, fn)
mzf
```

### Data hub {-}

The Bioconductor project had dedicated data hubs for experiment and
annotation data. Data that is accessed through these hubs are cached
centrally to avoid repeated downloads.

The `r BiocStyle::Biocexptpkg("MsDataHub")` package provides data for
mass spectrometry in general, and proteomics in particular. Once
loaded, the `MsDataHub()` function lists the available datasets

```{r MsDataHub, warning = FALSE}
library("MsDataHub")
MsDataHub()
```

The dataset table is also available as an [interactive
table](https://rformassspectrometry.github.io/MsDataHub/articles/MsDataHub.html)
on the package page.

Each data can then be downloaded with a dedicated function, for example

```{r ko15}
ko15.CDF()
```

Note that the (compressed)
`TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01-20141210.mzML`
file downloaded above happens to also be available in `MsDataHub`.

```{r}
MsDataHub::TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.20141210.mzML.gz()
```

### Experiment packages {-}

The `r BiocStyle::Biocexptpkg("msdata")` is an *experiment package*
that directly ships raw data files relevant for both proteomics and
metabolomics.

```{r msdatafiles, message = FALSE}
library("msdata")
## proteomics raw data
proteomics()
## proteomics identification data
ident()
## quantitative data
quant()
```

New data are added to the more modern and lightweight `MsDataHub`
infrastructure.


Often, experiment packages distribute processed data; examples thereof
are the `r BiocStyle::Biocexptpkg("pRolocdata")` and
`r BiocStyle::Biocexptpkg("scpdata")` packages, that ship processed
and annotated quantitative spatial and single-cell proteomics data.
